<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../bower_components/vaadin-text-field/src/vaadin-text-field.html">
<link rel="import" href="../../../bower_components/vaadin-text-field/src/vaadin-password-field.html">
<link rel="import" href="../../../bower_components/vaadin-button/src/vaadin-button.html">

<link rel="import" href="../../styles/styles.html">

<dom-module id="login-view">
  <template>
    <style include="styles">
      :host {
        width: 100vw;
        height: 100vh;
        --app-primary-color: var(--lumo-primary-color);
        --app-secondary-color: var(--lumo-body-text-color);

        background-color: var(--lumo-shade-5pct);
        display: flex;
        flex-direction: column;
        color: var(--lumo-body-text-color);
        font-family: var(--lumo-font-family);

        justify-content: center;
      }

      .container {
        margin: 0 auto;
        box-shadow: 0 2px 5px 0 var(--lumo-shade-10pct);
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }

      .login {
        padding: var(--lumo-space-l);
        background-color: var(--lumo-base-color);
        flex: 1;
      }

      .login__layout {
        display: flex;
        flex-direction: column;
      }

      .login__layout > * {
        width: 100%;
      }

      .login__button {
        margin-top: var(--lumo-space-m);
        width: 100%;
        max-width: 100%;
      }

      .error {
        display: flex;
        align-items: flex-start;
      }

      .error__icon {
        flex: 0 0 auto;
        fill: var(--lumo-error-color);
        margin-top: 1.3em;
        margin-right: var(--lumo-space-s);
      }

      .error__text {
        max-width: 35em;
      }

      @media (min-width: 750px) and (min-height: 450px) {
        .container {
          display: block;
          border-radius: 4px;
          max-width: 700px;
          overflow: hidden;
          height: auto;
        }
      }

      @media (min-width: 550px) {
        .login__layout {
          flex-direction: row;
          align-items: flex-end;
        }

        .login__layout > *:not(:first-child) {
          margin-left: var(--lumo-space-m);
        }

        .login__button {
          max-width: 7em;
        }
      }
    </style>

    <div class="container">
      <iron-form class="login" id="form" allow-redirect>
        <form method="post" action="login">
          <div class="login__layout">
            <vaadin-text-field id="username" name="username" label="Email" autofocus required></vaadin-text-field>
            <vaadin-password-field id="password" name="password" label="Password" required on-keydown="_onPasswordKeydown"></vaadin-password-field>
            <vaadin-button class="login__button" on-tap="login" theme="primary">
              Sign In
            </vaadin-button>
          </div>
          <template is="dom-if" if="[[error]]">
            <div class="error">
              <iron-icon icon="vaadin:exclamation-circle-o" class="error__icon"></iron-icon>
              <p class="error__text">
                The username and password you entered does not match our records. Please double-check and try again.
              </p>
            </div>
          </template>
        </form>
      </iron-form>
    </div>
  </template>

  <script>
    class LoginView extends Polymer.GestureEventListeners(Polymer.Element) {

      static get is() {
        return 'login-view';
      }

      static get properties() {
        return {
          error: {
            type: Boolean,
            value: false
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
      }

      login() {
        if (!this.$.username.invalid && !this.$.password.invalid) {
          this.$.form.submit();
        }
      }

      _onPasswordKeydown(event) {
        if (event.key === 'Enter' || event.keyCode == 13) {
          this.login();
        }
      }
    }

    window.customElements.define(LoginView.is, LoginView);
  </script>

</dom-module>
